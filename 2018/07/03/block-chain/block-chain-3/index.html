<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">



  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">







  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />





  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "511a53c9"
    });
  daovoice('update');
  </script>

















  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=kaiti:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="开源地址 前言这是区块链相关知识的一个梳理，旨在真正的get the skill并方便他人。 知识可分为两类:  逻辑体系型的 需要思考，把各种概念连起来，或归纳，或演绎，最后，在大脑中形成一种逻辑网状结构。比如可计算理论，分布式系统，解释器等。  使用操作型的 基本不需要思考，只需要看一下目录，要用的时候参考一下手册即可。比如linux的各种命令，go,python的一些奇怪语法,elastic">
<meta name="keywords" content="区块链">
<meta property="og:type" content="article">
<meta property="og:title" content="区块链 概述、开源">
<meta property="og:url" content="https://www.wuxinvip.com/2018/07/03/block-chain/block-chain-3/index.html">
<meta property="og:site_name" content="上善若水の技术簿">
<meta property="og:description" content="开源地址 前言这是区块链相关知识的一个梳理，旨在真正的get the skill并方便他人。 知识可分为两类:  逻辑体系型的 需要思考，把各种概念连起来，或归纳，或演绎，最后，在大脑中形成一种逻辑网状结构。比如可计算理论，分布式系统，解释器等。  使用操作型的 基本不需要思考，只需要看一下目录，要用的时候参考一下手册即可。比如linux的各种命令，go,python的一些奇怪语法,elastic">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.wuxinvip.com/img/block-chain/img/stream-table.png">
<meta property="og:image" content="https://www.wuxinvip.com/img/block-chain/img/how-money-is-created.png">
<meta property="og:image" content="https://www.wuxinvip.com/img/block-chain/img/bitcoin-issuance.png">
<meta property="og:image" content="https://www.wuxinvip.com/img/block-chain/img/bitcoin-supply-over-block-height.png">
<meta property="og:image" content="https://www.wuxinvip.com/img/block-chain/img/spending-bitcoin.png">
<meta property="og:image" content="https://www.wuxinvip.com/img/block-chain/img/data-structure.png">
<meta property="og:image" content="https://www.wuxinvip.com/img/block-chain/img/bitcoin-transaction-propagation.png">
<meta property="og:image" content="https://www.wuxinvip.com/img/block-chain/img/signing-output-to-spend.png">
<meta property="og:image" content="https://www.wuxinvip.com/img/block-chain/img/validate-stack.png">
<meta property="og:updated_time" content="2018-10-15T05:53:58.242Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="区块链 概述、开源">
<meta name="twitter:description" content="开源地址 前言这是区块链相关知识的一个梳理，旨在真正的get the skill并方便他人。 知识可分为两类:  逻辑体系型的 需要思考，把各种概念连起来，或归纳，或演绎，最后，在大脑中形成一种逻辑网状结构。比如可计算理论，分布式系统，解释器等。  使用操作型的 基本不需要思考，只需要看一下目录，要用的时候参考一下手册即可。比如linux的各种命令，go,python的一些奇怪语法,elastic">
<meta name="twitter:image" content="https://www.wuxinvip.com/img/block-chain/img/stream-table.png">



  <link rel="alternate" href="/atom.xml" title="上善若水の技术簿" type="application/atom+xml" />




  <link rel="canonical" href="https://www.wuxinvip.com/2018/07/03/block-chain/block-chain-3/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>区块链 概述、开源 | 上善若水の技术簿</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=130694104"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '130694104');
</script>








  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">上善若水の技术簿</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">时光荏苒、不浮青春.</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签<span class="badge">49</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类<span class="badge">47</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档<span class="badge">256</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">

    
    
    
      
    

    
      
    

    <a href="/calendar/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />日程表</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    
      
    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />站点地图</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.wuxinvip.com/2018/07/03/block-chain/block-chain-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="上善若水">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水の技术簿">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">区块链 概述、开源
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-03 08:00:00" itemprop="dateCreated datePublished" datetime="2018-07-03T08:00:00+08:00">2018-07-03</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <p><a href="https://gitee.com/null_071_4607/mastering-blockchain" target="_blank" rel="noopener">开源地址</a></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这是区块链相关知识的一个梳理，旨在真正的get the skill并方便他人。</p>
<p>知识可分为两类:</p>
<ul>
<li><p><strong>逻辑体系型的</strong></p>
<p>需要思考，把各种概念连起来，或归纳，或演绎，最后，在大脑中形成一种逻辑网状结构。比如可计算理论，分布式系统，解释器等。</p>
</li>
<li><p><strong>使用操作型的</strong></p>
<p>基本不需要思考，只需要看一下目录，要用的时候参考一下手册即可。比如linux的各种命令，go,python的一些奇怪语法,elastic-search dsl的使用。</p>
</li>
</ul>
<p>第一类知识是比较有意思的，值得多花时间，这种”逻辑网状结构”最后会形成一个”打通”的集群，可能会让你的大脑产生一些有意思的想法；而第二类，千万别花太多时间，因为很有可能让你产生消极，厌学，忧郁等情绪，而你越努力，就越可能”斯德哥尔摩”。</p>
<p>区块链知识可以归为第一类。</p>
<p>研究一个东西，需要知道它包含哪些概念，我把它分为两类:</p>
<a id="more"></a>
<ul>
<li><p><strong>自描述概念</strong></p>
<p>不依赖其他概念的概念</p>
</li>
<li><p><strong>他描述概念</strong></p>
<p>需要依赖其他概念的概念</p>
</li>
</ul>
<p>显然，这是一个递归的概念，可以用形式化的语言来描述，你也可以哲学的扯一大堆，但这不是我的兴趣。</p>
<p>下面的章节试图用<em>原理，逻辑，应用</em>的方式把区块链相关的概念连起来，形成”网状结构“，所有概念可在<a href="/glossary.md"><strong>Glossary(词汇表)</strong></a>里查看，你可以先浏览一下，想一想他们之间的关系，再来看下面的章节。当然，最后，每个人的”网状结构”可能都不同，毕竟除了”同一性”，还有”差异性”。但，原则是一致的，有了”网状结构”，在添加新的”概念”时，我们就可以审视其在”网”中的位置，也可以思考这张”网”还缺少什么，有什么不完美之处，是不是还有”孤岛”等问题，进而有可能去完善它。</p>
<p>而所有的学习，无非就是完善那张网，并尽可能的正交。</p>
<p>这样，垃圾少了，人也轻松了。</p>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><h2 id="1-KV-key-value"><a href="#1-KV-key-value" class="headerlink" title="1. KV(key value)"></a>1. KV(key value)</h2><blockquote>
<p>There are only two hard things in Computer Science: cache invalidation and <em><strong>naming things</strong></em>.</p>
<p>– Phil Karlton</p>
</blockquote>
<p>为什么名字那么重要？因为有了名字，这个名字才能够被引用，才能够谈论其属性。</p>
<p>就是说，你要谈论一个人，首先得有这个人，这有点废话，但却是原理性的，</p>
<p>名字意味着什么？</p>
<p>图灵机里面的head,没错，只有你找到head,才知道当前的(input,state),才能往下走。</p>
<p>汇编语言如果没有address,存储和操作也没法进行;各种编程语言的变量说的也是这个事情。</p>
<p>而kv中的k其实就是名字，v在不同的场合可以有不同的含义。</p>
<p>有了kv,就可以构造所有的数据结构，因为从递归的角度，v也可以是kv。</p>
<p>这个跟blockchain有关系吗？</p>
<h2 id="2-Asset-资产"><a href="#2-Asset-资产" class="headerlink" title="2. Asset(资产)"></a>2. Asset(资产)</h2><p>在digital asset的世界，address上的数字就是资产。显然，address是key,数字是value。<br>理解这一点很重要，blockchain主要主要的应用场景就是数字资产。</p>
<p>不太精确的分类:</p>
<ul>
<li><p>资产数字化</p>
<p>相当于一个凭证，其有现实的对应物，比如股票，其实对应公司的投票分红等权利。</p>
</li>
<li><p>数字资产化</p>
<p>没有现实的对应物，但是可以换成现实中的钱，比如比特币。</p>
</li>
</ul>
<h2 id="3-Transaction-交易"><a href="#3-Transaction-交易" class="headerlink" title="3. Transaction(交易)"></a>3. Transaction(交易)</h2><p>而address上的数字的变更，也就是kv的变化，对应着资产的转移，就是<strong>交易(transaction)</strong>。</p>
<p>如果能把所有KV的变化按顺序记录起来，就达到了<strong>可溯源</strong>的目的，这跟kafka里面的stream和table的关系是一样的。</p>
<p><img src="/img/block-chain/img/stream-table.png" alt="图片"></p>
<p>可以看出，我们可以根据交易记录，来得到目前每个地址的资产；而资产的变化必须以目前的资产为前提。</p>
<p>事实上，这个保证是consensus mechanism(共识机制)里面的一个检查点。</p>
<h2 id="4-Currency-issuance-货币发行"><a href="#4-Currency-issuance-货币发行" class="headerlink" title="4. Currency issuance(货币发行)"></a>4. Currency issuance(货币发行)</h2><p>那么资产从哪里来呢？</p>
<p>上帝说，要有光就有了光。</p>
<p>这里我们不去讨论历史，只从现实的货币发行制度以及比特币”怼”的方式阐述。</p>
<h3 id="4-1-美元的发行流程"><a href="#4-1-美元的发行流程" class="headerlink" title="4.1 美元的发行流程"></a>4.1 美元的发行流程</h3><p><img src="/img/block-chain/img/how-money-is-created.png" alt="图片"></p>
<ul>
<li>没钱花了，国会和总统授权财政部,发行国债</li>
<li>国债大部分卖给中国和日本，有钱了</li>
<li>又没钱花了，中国日本也不要，通过银行卖给美联储，有钱了，这个钱是凭空出来的，<strong>Currency issuance(货币发行)</strong> works</li>
<li>债券是有利率的，就是说偿还债务时需要比借的钱要多一些</li>
<li>而发行的钱=借出的钱，这多一些的钱从哪里来呢？</li>
<li>唯一的办法就是继续借，也就是继续发行，否则这个系统就没法运转下去</li>
</ul>
<p>这个系统的必然结果是:</p>
<ul>
<li>inflation(通货膨胀)</li>
<li>在经济增长对货币需求量增加的情况下，债务只可能越来越大</li>
<li>但是，只要有信心，这个系统就可以一直运行下去</li>
<li>并且，似乎其还有一个作用，生产力高的人更容易获得金钱</li>
<li>因为如果你赚的钱如果不足以覆盖你使用钱的成本，你就会被淘汰</li>
<li>这个系统不完美，但支撑了资本主义的高速发展</li>
<li>似乎繁荣,萧条的周期跟这个系统有很大的关系</li>
<li>它还在高速运转</li>
</ul>
<h3 id="4-2-比特币的发行流程"><a href="#4-2-比特币的发行流程" class="headerlink" title="4.2 比特币的发行流程"></a>4.2 比特币的发行流程</h3><p>比特币的创世区块，上面有一句话:</p>
<blockquote>
<p>“The Times 03/Jan/2009 Chancellor on brink of second bailout for banks”<br>“财政大臣站在第二次救助银行的边缘”</p>
</blockquote>
<p>这句话是当天泰晤士报头版的标题。中本聪将它写进创世区块，不但清晰地展示着比特币的诞生时间，还表达着对旧体系的嘲讽。</p>
<p>银行家的贪婪，政府的监守自盗，大而不倒的把戏，已经有太多的批评，这里不再赘述。</p>
<p>试验性质的比特币，试图回答两个问题:</p>
<ul>
<li>谁该拥有货币发行权</li>
<li>货币发行量由什么决定</li>
</ul>
<p><img src="/img/block-chain/img/bitcoin-issuance.png" alt="图片"></p>
<p>比特币的答案是:</p>
<ul>
<li>众生平等，你有我有全都有</li>
<li>货币发行量预期固定，每4年减半</li>
</ul>
<p><img src="/img/block-chain/img/bitcoin-supply-over-block-height.png" alt="图片"></p>
<p>这里有太多话题性的东西:</p>
<ul>
<li>依靠算力真的能做到去中心化？公平？民主？</li>
<li>指数衰减的货币真的有利于经济发展？</li>
<li>这种越早加入网络越容易拥有更多资产的机制是传销吗?</li>
</ul>
<p>这些东西都可以去讨论。</p>
<p>从技术的角度，这里对应着数据的记录和计算的机制，在 <strong>distributed network(分布式网络)</strong> 的环境下，就是所谓的 <strong>consensus mechanism(共识机制)</strong>。</p>
<h2 id="5-Distributed-network-分布式网络"><a href="#5-Distributed-network-分布式网络" class="headerlink" title="5. Distributed network(分布式网络)"></a>5. Distributed network(分布式网络)</h2><p><strong>一群人</strong> <strong>合作</strong> 来 <strong>搞事情</strong>，就形成了网络。</p>
<p>这里的人叫node(节点),搞事情的过程中，一个不行了，另一个顶上，就叫failover。</p>
<p>常见的搞事情，比如LB,replica storage等。</p>
<p>这里的合作遵循的规则就叫 <strong>consensus mechanism(共识机制)</strong>。</p>
<p>如果这群人都很聪明，并且互相信任，事情会简单很多。</p>
<p>很多的系统都是以此为假设进行设计的。</p>
<p>区块链的假设是:节点之间是互相不信任的。</p>
<p>区块链要干的事情就是:设计一个能让互相<strong>不信任</strong>的节点都<strong>信任</strong>的机制,然后大家可以愉快的一起搞事情。</p>
<h2 id="6-Consensus-mechanism-共识机制"><a href="#6-Consensus-mechanism-共识机制" class="headerlink" title="6. Consensus mechanism(共识机制)"></a>6. <strong>Consensus mechanism(共识机制)</strong></h2><p>在跟资产相关的世界里，这个机制需要做到:</p>
<ul>
<li>确保某个address的数字只能由拥有它的人来操作</li>
<li>交易记录无法篡改</li>
<li>交易记录可追溯</li>
</ul>
<p>比特币也是围绕这几个问题展开的，当然它还干了其他几件牛B的事情:</p>
<ul>
<li>在去中心化的条件下解决spend twice的问题</li>
<li>防止通货膨胀的货币发行机制</li>
</ul>
<p><strong>完全的去中心化</strong>对区块链来说并不是一个必选项，就大部分的商业活动看，去中心化反而会增加很多不必要的复杂性。</p>
<p>发币也不是必选项。</p>
<p>我们先来看如何做到<em>确保某个address的数字只能由拥有它的人来操作</em>，<em>交易记录无法篡改</em>，<em>交易记录可追溯</em></p>
<h2 id="7-Cryptography-密码学"><a href="#7-Cryptography-密码学" class="headerlink" title="7. Cryptography(密码学)"></a>7. Cryptography(密码学)</h2><h3 id="7-1-Asymmetric-cryptography-非对称加密"><a href="#7-1-Asymmetric-cryptography-非对称加密" class="headerlink" title="7.1 Asymmetric cryptography(非对称加密)"></a>7.1 Asymmetric cryptography(非对称加密)</h3><ul>
<li><p>公钥加密，只有对应的私钥能够解密</p>
<p>加密货币中的address对应公钥(bitcoin的实现里面，为了隐藏身份，对public key做了hash),对该address的资产进行操作的唯一条件是:拥有对应的私钥。</p>
</li>
<li><p>私钥签名，公钥能够验证是不是对应的私钥签名的</p>
<p>把公钥和签名广播出去，nodes可以验证交易的有效性。</p>
</li>
<li><p>篡改无效<br>签名的信息确实是签名者本人的意愿，nodes能对此进行确认。</p>
</li>
<li><p>PKI中利用CA颁发证书的方式来确定网络中的身份</p>
<p>对于公有链，peer可以自由加入，退出，并不需要一个中心化的CA来对身份进行认证;联盟链，peer的身份和权限可利用该机制来实现，比如hyperledger中的msp</p>
<p>比特币的交易:</p>
<p><img src="/img/block-chain/img/spending-bitcoin.png" alt="图片"></p>
</li>
</ul>
<p>这就回答了，如何做到<strong>确保某个address的数字只能由拥有它的人来操作</strong>的问题。</p>
<h3 id="7-2-SHA-Secure-Hash-Algorithm"><a href="#7-2-SHA-Secure-Hash-Algorithm" class="headerlink" title="7.2 SHA(Secure Hash Algorithm)"></a>7.2 SHA(Secure Hash Algorithm)</h3><ul>
<li>任意长度的数据-&gt;固定长度的数据</li>
<li>相同input-&gt;相同output</li>
<li>冲突几率很小,改变input的一个字符，output都会不同</li>
<li>验证hash value很容易，反推很难<blockquote>
<p>计算一个任意长度input的hash value非常快，但是给出一个output，要算出input却非常难，目前只有遍历试验的方法。Bitcoin中会根据目前的平均出块速度，给出一个ouput,谁先构造出hash(input)小于该output的数据，谁就拥有当前出块的权利。这个遍历试验的过程就叫做<strong>挖矿(mining)</strong>，当某个peer找到符合条件的input,它会广播给其他peer,其他peer对其进行验证，这个遍历试验并向大家证明的过程，就叫做<strong>POW</strong>;而每一次出块会有一定的奖励，这个奖励是比特币产生(coinbase)的唯一方式,而区块中确认交易的output和input的差额就是给记账peer的<strong>手续费(transaction fee)</strong>。</p>
</blockquote>
</li>
</ul>
<p>而做到交易记录<strong>无法篡改</strong>和<strong>可追溯</strong>,还需要block chain这种数据结构。</p>
<h2 id="8-Hash-chain-amp-amp-Block-chain"><a href="#8-Hash-chain-amp-amp-Block-chain" class="headerlink" title="8. Hash chain &amp;&amp; Block chain"></a>8. Hash chain &amp;&amp; Block chain</h2><p>block chain其实是一种特殊的hash chain。</p>
<p><img src="/img/block-chain/img/data-structure.png" alt="图片"></p>
<p>首先，数据是存在分布式网络的各个节点中的，这些节点有可能有些是坏人，”不可篡改“是指整个分布式网络对外提供的block chain data是”不可篡改”的。恶意节点的篡改，得不到承认，并且不影响对外的服务。</p>
<p>比特币中的好人们商量好:我们只认best block chain,就是符合规则(consensus mechanism)并且最长的那条链。</p>
<p>下面结合block chain的具体结构和相应的consensus mechanism来说明,why”不可篡改”?</p>
<p>block chain数据结构的特点是:</p>
<ul>
<li>链式存储，从任何一个block可以找到其前面的block</li>
<li>且每一个block(Genesis block除外)有上一个block的hash</li>
</ul>
<p>由于hash的”<strong>冲突几率很小,改变input的一个字符，output都会不同</strong>“的特性，改变一个区块的数据将会导致后面区块的hash对不上，也许你会说,”改变后面block的hash不就行了？”，但是，由于后面的block也改变了，那么其hash也改变了，而一个block有效的一个必要条件:</p>
<blockquote>
<p>hash(block)&lt;根据当前平均出块速度计算出的target</p>
</blockquote>
<p>系统会计算当前1小时的平均出块速度，动态调整difficulty,得出一个target，而一个有效的区块，不但要拥有前一个区块的hash,还必须计算出一个nonce,使得当前block的hash值小于该target。</p>
<p>这意味着，改变任何一个block,并且想跟上目前最长的链，需要重做生成后面所有block的工作量。</p>
<p>而这是非常难的。</p>
<p>理论上，跟所有honest peers竞争，掌握51%以上的算力是有可能对数据进行篡改的，但是，假如你的算力真的非常强，你可以把交易都篡改了，这是否能让你的利益最大化呢？首先，这个篡改肯定会被发现，当honest peers发现很长的不匹配block时，会发出告警，然后用户也会知道，这会导致什么结果呢？一个必然的结果是：系统无法被人信任，价值归0。而拥有强大的算力，并且选择做honest peer，你会获得不错的稳定收益;这就导致强大的算力更倾向于做honest peer,而拥有越多强大算力的honest peer,整个系统就越难被攻破。这就是人性，这就是市场。</p>
<p>所以，比特币里面不可篡改的保证靠的是:<strong>POW</strong> + <strong>block chain存储</strong> + <strong>激励措施的博弈</strong></p>
<p>但是，这里一个很致命的问题是:POW太浪费电了……</p>
<p>那么，有没有既不浪费电又能够保证”不可篡改”的办法呢？</p>
<p>至少，在”去中心化”的条件下是很难实现的。</p>
<ul>
<li><p>PoS(Proof of Stake)</p>
<p>相当于越有钱，越有话语权(挖矿或者确认交易)，意思是越有钱越想维持这个系统，越不会想破坏这个系统，从而数据也是”不可篡改的”;但是，这个将导致一个很明显的结果:有钱的会越来越有钱。越来越集中化。</p>
</li>
<li><p>PBFT(Practical Byzantine Fault Tolerance )?</p>
<p>意思是n个peers互相交换对new block的看法，然后honest peer取majority(n-1)的看法来决定new block是否合法,可以证明，只要坏人不超过 (n-1) / 3 ，整个系统就是按honest peer来运行的。</p>
<p>“不可篡改”的保证在于:你需要majority的同意(一般通过签名来保证)，而少数恶意节点显然做不到。</p>
</li>
</ul>
<p>为了交易速度和省电，目前很多加密货币采用了Pos;而PBFT由于需要知道有多少其他peers并能识别其签名，一般适合私有链，联盟链。</p>
<p>需要注意的是，区块链里面说的共识算法，跟一般分布式系统里面的paxos,raft等一致性协议相比,除了关注网络本身的失效外，还需要对数据的安全性，合约的有效性做很多的工作。</p>
<h2 id="9-Blockchain-区块链"><a href="#9-Blockchain-区块链" class="headerlink" title="9. Blockchain(区块链)"></a>9. Blockchain(区块链)</h2><p>所以，其实给区块链下一个定义不是一件容易的事情。</p>
<p>wikipedia:</p>
<blockquote>
<p>A blockchain, originally block chain, is a continuously growing list of records, called blocks, which are linked and secured using cryptography. Each block typically contains a cryptographic hash of the previous block, a timestamp and transaction data.</p>
</blockquote>
<p>investopedia:</p>
<blockquote>
<p>A blockchain is a digitized, decentralized, public ledger of all cryptocurrency transactions. Constantly growing as ‘completed’ blocks (the most recent transactions) are recorded and added to it in chronological order, it allows market participants to keep track of digital currency transactions without central recordkeeping. Each node (a computer connected to the network) gets a copy of the blockchain, which is downloaded automatically.</p>
</blockquote>
<p>百度百科:</p>
<blockquote>
<p>狭义来讲，区块链是一种按照时间顺序将数据区块以顺序相连的方式组合成的一种链式数据结构， 并以密码学方式保证的不可篡改和不可伪造的分布式账本。</p>
<p>广义来讲，区块链技术是利用块链式数据结构来验证与存储数据、利用分布式节点共识算法来生成和更新数据、利用密码学的方式保证数据传输和访问的安全、利用由自动化脚本代码组成的智能合约来编程和操作数据的一种全新的分布式基础架构与计算方式。</p>
</blockquote>
<p>感觉每一个说得都很有道理,也确实都很有道理。</p>
<p>不管如何，上面说的原理部分，基本上就是区块链最核心的部分，虽然各种具体实现有很多细节的不同，但原理就这些了。</p>
<p>而根据区块链发展的历史，<strong>智能合约</strong>的引入就进入了所谓的区块链2.0时代。</p>
<p>连接移动端,Iot就进入了所谓的区块链3.0时代。</p>
<p>是不是有种被时代抛弃的感觉？劳资还在守着java当饭碗，侬都区块链3.0了？</p>
<h2 id="10-Smart-contract-智能合约"><a href="#10-Smart-contract-智能合约" class="headerlink" title="10. Smart contract(智能合约)"></a>10. Smart contract(智能合约)</h2><h2 id="10-1-比特币的脚本语言"><a href="#10-1-比特币的脚本语言" class="headerlink" title="10.1 比特币的脚本语言"></a>10.1 比特币的脚本语言</h2><p>其实代表区块链1.0的比特币也没有那么不智能，我们来看其交易验证的逻辑:</p>
<p><img src="/img/block-chain/img/bitcoin-transaction-propagation.png" alt="图片"></p>
<p>交易必须遵守以下规则:</p>
<ul>
<li>任何一个input必须来自于某一个output</li>
<li>一笔交易，可以有多个input,多个output</li>
<li>为了方便，input被spend后就作废了，如果有change(找零)，也体现在output中</li>
<li>可以推断，这科树的叶子记录的address对应的资产就是当前整个比特币的资产状况</li>
<li>叶子上的output也叫UTXO(Unspent Transaction Output)</li>
<li>有效的input必须来自UTXO</li>
<li>UXTO里面有public key的hash,对其操作必须提供private key签名和public key</li>
<li>网络节点根据共识机制维护公共账本,这实际上解决了spend twice的问题</li>
</ul>
<p>这里的验证逻辑就是contract(合约)。</p>
<p><img src="/img/block-chain/img/signing-output-to-spend.png" alt="图片"></p>
<ul>
<li>Public script包含了UTXO对应的Publick key的hash</li>
<li>Signature script包含了private key的签名以及public key</li>
<li>被签名的信息包含下一个UXTO的Public script和amount</li>
</ul>
<p>这里的script是一种非图灵完备的stack-based的脚本语言。</p>
<p>Public script：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OP_DUP OP_HASH160 &lt;PubkeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG</span><br></pre></td></tr></table></figure></p>
<p>Signature script<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Sig&gt; &lt;PubKey&gt; OP_DUP OP_HASH160 &lt;PubkeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG</span><br></pre></td></tr></table></figure></p>
<p>其执行过程如下:</p>
<p><img src="/img/block-chain/img/validate-stack.png" alt="图片"></p>
<p>每个节点都会对收到的transaction自动执行以上的验证逻辑。</p>
<p>而如果支持图灵完备语言来编写合约，并可动态部署，就叫<strong>智能合约</strong>。</p>
<h2 id="10-2-Hyperledger-fabric的chaincode"><a href="#10-2-Hyperledger-fabric的chaincode" class="headerlink" title="10.2 Hyperledger-fabric的chaincode"></a>10.2 Hyperledger-fabric的chaincode</h2><p>以太坊，超级账本等区块链2.0平台支持<strong>智能合约</strong>，本质上就是提供一个可编程的区块链平台，底层的区块链存储，一致性机制等通用的东西给你搭好了，你可以在上面很方便的编写自己的应用。</p>
<p>可以理解为一种paas,编程框架和云平台的结合。</p>
<p>下面就Hyperledger-fabric的chaincode来做具体说明。</p>
<p>所谓编写chaincode,其实就是提供一些服务，这些服务会对KV进行操作，这里的隐含条件是:</p>
<ul>
<li>KV的变更其实就是transaction,会遵守consensus记录到公共账本上</li>
<li>对某个Key的操作，是否需要相应的权限，取决于你的实现</li>
<li>大家约定需要权限，那就需要权限，约定不需要，那就不需要；也可以某些需要，某些不需要</li>
<li>原则上比特币的coinbase,PubScript+SigScript解锁的操作方式都可以实现在chaincode中</li>
<li>所以，其实chaincode的framework其实只是提供了get,set的最基本的方法</li>
<li>部署chaincode和调用chaincode的权限也是可以大家商量的</li>
<li>这种非常灵活的方式，能做的东西非常多</li>
<li>但是整个权限的约定，chaincode的编写，部署都非常繁琐</li>
<li>并且现在hyperledger fabric并没有一个统一的管理这些东西的地方</li>
<li>不理解底层原理，搞起来还是相当麻烦</li>
</ul>
<h1 id="联系方式"><a href="#联系方式" class="headerlink" title="联系方式"></a>联系方式</h1><p>QQ群:300911873</p>
<p>目前正在迭代的项目:</p>
<p><a href="https://github.com/foolcage/mastering-fabric" target="_blank" rel="noopener">https://github.com/foolcage/mastering-fabric</a></p>
<p><a href="https://github.com/foolcage/fooltrader" target="_blank" rel="noopener">https://github.com/foolcage/fooltrader</a></p>
<p>欢迎关注 一起探讨</p>

      
    </div>

    
      

  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2018/07/02/block-chain/block-chain-0/" rel="bookmark">谈谈区块链对互联网的冲击</a></div>
      
    </li>
  
  </ul>


    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/区块链/" rel="tag"># 区块链</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/03/load-balance/nginx-plus/" rel="next" title="nginx-plus">
                <i class="fa fa-chevron-left"></i> nginx-plus
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/03/load-balance/nginx-controller/" rel="prev" title="nginx-controller">
                nginx-controller <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
     <div id="gitalk-container"></div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="上善若水" />
            
              <p class="site-author-name" itemprop="name">上善若水</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">256</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">47</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">49</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/wuxinvip" title="GitHub &rarr; https://github.com/wuxinvip" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://gitee.com/none_heart" title="Gitee &rarr; https://gitee.com/none_heart" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://blog.csdn.net/huoyan403" title="CSDN &rarr; https://blog.csdn.net/huoyan403" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="mailto:wuxinvipcom@gmail.com" title="E-Mail &rarr; mailto:wuxinvipcom@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
            </div>
          

          

          
           
              <div class="links-of-blogroll motion-element links-of-blogroll-block">
                <div class="links-of-blogroll-title">
                   安卓app下载
                </div>
               <img src="/images/download/android-download.png" />
               <!--增加以前旧版本连接博文-->
               <a href="https://www.wuxinvip.com/2018/12/04/version/version-1/" >Previous Releases</a>
              </div>
           

          
          

          
          

          
            
          
          

        </div>

      </section>


      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#原理"><span class="nav-number">2.</span> <span class="nav-text">原理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-KV-key-value"><span class="nav-number">2.1.</span> <span class="nav-text">1. KV(key value)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Asset-资产"><span class="nav-number">2.2.</span> <span class="nav-text">2. Asset(资产)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Transaction-交易"><span class="nav-number">2.3.</span> <span class="nav-text">3. Transaction(交易)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Currency-issuance-货币发行"><span class="nav-number">2.4.</span> <span class="nav-text">4. Currency issuance(货币发行)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-美元的发行流程"><span class="nav-number">2.4.1.</span> <span class="nav-text">4.1 美元的发行流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-比特币的发行流程"><span class="nav-number">2.4.2.</span> <span class="nav-text">4.2 比特币的发行流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Distributed-network-分布式网络"><span class="nav-number">2.5.</span> <span class="nav-text">5. Distributed network(分布式网络)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Consensus-mechanism-共识机制"><span class="nav-number">2.6.</span> <span class="nav-text">6. Consensus mechanism(共识机制)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-Cryptography-密码学"><span class="nav-number">2.7.</span> <span class="nav-text">7. Cryptography(密码学)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-Asymmetric-cryptography-非对称加密"><span class="nav-number">2.7.1.</span> <span class="nav-text">7.1 Asymmetric cryptography(非对称加密)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-SHA-Secure-Hash-Algorithm"><span class="nav-number">2.7.2.</span> <span class="nav-text">7.2 SHA(Secure Hash Algorithm)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Hash-chain-amp-amp-Block-chain"><span class="nav-number">2.8.</span> <span class="nav-text">8. Hash chain &amp;&amp; Block chain</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-Blockchain-区块链"><span class="nav-number">2.9.</span> <span class="nav-text">9. Blockchain(区块链)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-Smart-contract-智能合约"><span class="nav-number">2.10.</span> <span class="nav-text">10. Smart contract(智能合约)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-比特币的脚本语言"><span class="nav-number">2.11.</span> <span class="nav-text">10.1 比特币的脚本语言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-Hyperledger-fabric的chaincode"><span class="nav-number">2.12.</span> <span class="nav-text">10.2 Hyperledger-fabric的chaincode</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#联系方式"><span class="nav-number">3.</span> <span class="nav-text">联系方式</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      
    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">上善若水</span>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1273992689&web_id=1273992689" language="JavaScript"></script>
  </div>



        
      </div>
    </footer>

    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.6.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  










  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: 'c44af7c5b377f551c3bd',
          clientSecret: 'eeb965cbf5d59e1ca5e51c0112b8c87bc15eed43',
          repo: 'wuxinvip.github.io',
          owner: 'wuxinvip',
          admin: ['wuxinvip'],
          id: location.pathname,
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')
       </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  



  

  

 
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>



  <script>
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>


  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('复制成功')
          else $(this).text('复制失败')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('复制')
        }, 300)
      }).append(e)
    })
  </script>


  

</body>
</html>
